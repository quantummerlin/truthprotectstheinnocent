{% assign current_lang = page.lang | default: "en" %}
{% assign og_locale = "en_US" %}
{% if current_lang == "it" %}{% assign og_locale = "it_IT" %}{% endif %}
{% if current_lang == "de" %}{% assign og_locale = "de_DE" %}{% endif %}
{% if current_lang == "fr" %}{% assign og_locale = "fr_FR" %}{% endif %}
{% if current_lang == "es" %}{% assign og_locale = "es_ES" %}{% endif %}
{% if current_lang == "pt" %}{% assign og_locale = "pt_PT" %}{% endif %}
{% if current_lang == "ru" %}{% assign og_locale = "ru_RU" %}{% endif %}
{% if current_lang == "pl" %}{% assign og_locale = "pl_PL" %}{% endif %}
<!DOCTYPE html>
<html lang="{{ current_lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- Primary Meta Tags -->
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    <meta name="title" content="{{ page.title | default: site.title }}">
    <meta name="description" content="{{ page.description | default: site.description }}">
    <meta name="keywords" content="Birmingham-Trevallion, family rights, child welfare, Italy, Australia, homeschooling, parental rights, truth, justice">
    <meta name="author" content="{{ site.author }}">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="{{ site.url }}{{ page.url }}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ site.url }}{{ page.url }}">
    <meta property="og:title" content="{{ page.title | default: site.title }}">
    <meta property="og:description" content="{{ page.description | default: site.description }}">
    <meta property="og:image" content="{{ site.url }}/assets/images/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="{{ site.title }}">
    <meta property="og:locale" content="{{ og_locale }}">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ site.url }}{{ page.url }}">
    <meta name="twitter:title" content="{{ page.title | default: site.title }}">
    <meta name="twitter:description" content="{{ page.description | default: site.description }}">
    <meta name="twitter:image" content="{{ site.url }}/assets/images/og-image.jpg">
    
    <!-- Mobile App Meta -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Truth Protects">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1e3a5f">
    <meta name="msapplication-TileColor" content="#1e3a5f">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/assets/images/favicon.png">
    <link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/assets/css/style.css">
    
    <!-- Structured Data / Schema.org -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "{{ site.title }}",
        "description": "{{ site.description }}",
        "url": "{{ site.url }}",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "{{ site.url }}/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    {% if page.layout == 'post' %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "{{ page.title }}",
        "description": "{{ page.description | default: page.excerpt | strip_html | truncate: 160 }}",
        "datePublished": "{{ page.date | date_to_xmlschema }}",
        "author": {
            "@type": "Organization",
            "name": "{{ site.author }}"
        },
        "publisher": {
            "@type": "Organization",
            "name": "{{ site.title }}"
        }
    }
    </script>
    {% endif %}
    
    <!-- Jekyll SEO Tag -->
    {% seo %}
    <link rel="alternate" hreflang="x-default" href="{{ site.url }}/" />
    <link rel="alternate" hreflang="en" href="{{ site.url }}/" />
    <link rel="alternate" hreflang="it" href="{{ site.url }}/it/" />
    <link rel="alternate" hreflang="de" href="{{ site.url }}/de/" />
    <link rel="alternate" hreflang="fr" href="{{ site.url }}/fr/" />
    <link rel="alternate" hreflang="es" href="{{ site.url }}/es/" />
    <link rel="alternate" hreflang="pt" href="{{ site.url }}/pt/" />
    <link rel="alternate" hreflang="ru" href="{{ site.url }}/ru/" />
    <link rel="alternate" hreflang="pl" href="{{ site.url }}/pl/" />
</head>
<body>
    <!-- Header -->
    <header class="site-header" id="site-header">
        <div class="container">
            <div class="header-content">
                <a href="/" class="site-logo">
                    <span class="logo-icon">⚖️</span>
                    <span class="logo-text">Truth Protects The Innocent</span>
                </a>
                
                <button class="mobile-menu-toggle" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <nav class="main-nav">
                    <ul>
                        {% for item in site.navigation %}
                        <li><a href="{{ item.url }}" {% if page.url == item.url %}class="active"{% endif %}>{{ item.title }}</a></li>
                        {% endfor %}
                    </ul>
                    <a href="/#share-now" class="nav-share-btn">Share Now</a>
                </nav>
                <div class="language-toggle" aria-label="Language selector">
                    <a href="/" class="{% if current_lang == 'en' %}active{% endif %}">EN</a>
                    <a href="/it/" class="{% if current_lang == 'it' %}active{% endif %}">IT</a>
                    <a href="/de/" class="{% if current_lang == 'de' %}active{% endif %}">DE</a>
                    <a href="/fr/" class="{% if current_lang == 'fr' %}active{% endif %}">FR</a>
                    <a href="/es/" class="{% if current_lang == 'es' %}active{% endif %}">ES</a>
                    <a href="/pt/" class="{% if current_lang == 'pt' %}active{% endif %}">PT</a>
                    <a href="/ru/" class="{% if current_lang == 'ru' %}active{% endif %}">RU</a>
                    <a href="/pl/" class="{% if current_lang == 'pl' %}active{% endif %}">PL</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="site-main">
        {{ content }}
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Truth Protects The Innocent</h4>
                    <p>A documentary resource presenting facts about the Birmingham-Trevallion family case.</p>
                    <p style="margin-top: 1rem;"><strong>#TruthProtectsTheInnocent</strong></p>
                </div>
                
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="/family/">The Family</a></li>
                        <li><a href="/evidence/">Evidence & Timeline</a></li>
                        <li><a href="/action/">Take Action</a></li>
                        <li><a href="/media/">Media Resources</a></li>
                        <li><a href="/updates/">Latest Updates</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>The Facts</h4>
                    <ul class="principles-list">
                        <li>3 children separated from parents</li>
                        <li>3 official reasons given</li>
                        <li>All 3 reasons proven false</li>
                        <li>Children now showing documented harm</li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; {{ 'now' | date: "%Y" }} Truth Protects The Innocent. All content shared for awareness and accountability.</p>
                <p class="disclaimer">This site documents information from supporters and official sources. We do not officially represent the family.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        // Mobile Menu Toggle
        document.querySelector('.mobile-menu-toggle').addEventListener('click', function() {
            document.querySelector('.main-nav').classList.toggle('active');
            this.classList.toggle('active');
        });
        
        // Header scroll effect
        const header = document.getElementById('site-header');
        let lastScroll = 0;
        
        window.addEventListener('scroll', () => {
            const currentScroll = window.pageYOffset;
            
            if (currentScroll > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
            
            lastScroll = currentScroll;
        });
        
        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
        
        // Animate elements on scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-fade-in-up');
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);
        
        document.querySelectorAll('.evidence-card, .action-card, .video-card, .stat-card').forEach(el => {
            el.style.opacity = '0';
            observer.observe(el);
        });
        
        // Video lazy loading and play on hover (optional enhancement)
        document.querySelectorAll('.video-card video').forEach(video => {
            video.addEventListener('mouseenter', function() {
                if (this.paused) {
                    this.play().catch(() => {}); // Catch autoplay restrictions
                }
            });
            video.addEventListener('mouseleave', function() {
                if (!this.paused && !this.hasAttribute('controls-active')) {
                    this.pause();
                }
            });
            video.addEventListener('play', function() {
                this.setAttribute('controls-active', 'true');
            });
        });
    </script>

    <!-- Scroll to top on page load -->
    <script>
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }
        window.addEventListener('beforeunload', function() {
            window.scrollTo(0, 0);
        });
        window.addEventListener('load', function() {
            setTimeout(function() {
                window.scrollTo(0, 0);
            }, 0);
        });
    </script>
</body>
</html>